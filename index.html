<!DOCTYPE html>
<html lang="en">

<?php include "index.php";?>

<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> 
   <title>New York Times Search</title>

 <!--  <link rel="stylesheet" href="../assets/css/font-awesome.min.css"> -->
  <link rel="stylesheet" type="text/css" href="assets/css/style.css">
</head>

<body>



  
  
  <script src="https://use.fontawesome.com/7b6dd2ca46.js"></script>
<div class="container">
    <div class="jumbotron">
<!-- here is the link given to me by glyphSearch for the newspaper icon. I don't know how to make it work -->
<i class="fa fa-newspaper-o"></i> 
    New York Times Search</div>

     
<div class="container" >
   <div class="row">
      <div class="panel panel-default">
        <div class="panel-heading" id="searchpar">
          <i class="fa fa-table"></i>
          Search Parameters
        </div>
        <div class="panel-body">
        <form>
        <div class="form-group">
          <label for="exampleInputEmail1">Search Term:</label>
          <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Keyword">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">Number of Records to Retrieve:</label>
          <input type="text" class="form-control" id="numRecords" placeholder="5">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">Start Year (Optional):</label>
          <input type="number" class="form-control" id="startDate" >
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">End Year (Optional):</label>
          <input type="number" class="form-control" id="endDate" >
        </div>
        </form>
        <button type="submit" class="btn" id="frmSubmit" id="test">
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
        Search
        </button>
        <button type="submit" class="btn" id="clr">
        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        Clear Results</button>

      
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container" id="rContainer">
   <div class="row">
      <div class="panel panel-default">
        <div class="panel-heading" id="searchpar">
          <h3>Search Results</h3>
        </div>
        <div class="panel-body" id="display">
        <table class="table">
          <thead class="thead-inverse">
            <tr>
            <th>Image</th>
            <th>Heading</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody>
          <tr>
          <div id="display">
<!--          all the <th> contents that are generated below go in here-->          </div>
        </tr>
        </tbody>
      </table>
        </div>
      </div>
  
    </div>
  </div>

  
  <!-- Displaying the results -->



  
   
    
 


<script src="https://code.jquery.com/jquery.js"></script>
 <script type="text/javascript">

  $("button").on("click", function() {

    var url = "https://api.nytimes.com/svc/search/v2/articlesearch.json";
    var base_url = "http://www.nytimes.com/";
    var q = ($("#exampleInputEmail1").val()).trim();
    var begin_date = ($("#startDate").val()).trim();
    var end_date = ($("#endDate").val()).trim();
    
    url += '?' + $.param({
      'api-key': "05dd5e0a5d1841718337d9de569ceb6c",
      'q':  q,
      'hl': "true",
      'facet_field': "source",
      'facet_filter': "true"
    });

    // Add date only if the user inputs the date
    if(begin_date != ""){
      url += '&begin_date='+ begin_date + '0101';
    }
    if(end_date != ""){
      url += '&begin_date='+ end_date + '0101';
    }
    console.log(url); 

    $.ajax({

        url: url,
        method: 'GET'

    })
    .done(function(database) {
      // response.addHeader("Access-Control-Allow-Origin", "http://www.nytimes.com");
          console.log(database);

          var results = database.response.docs;
          console.log(results.length);

        for (var i = 0; i < results.length; i++) {
            var newsDiv = $("<div class='item'>");

            var img = $("<img>");
            var link = $("<a>");
            
            // Check if an image url is being returned in the response
            // if not put in a place holder
            if (results[i].multimedia.length > 0) {
              var docImage = base_url + results[i].multimedia[0].url;
              img.attr("src" , docImage);
              console.log(results[i].multimedia[0].url)
            }else{
              img.attr("src" , "assets/images/placeholder.jpg");
            }

            

            var headText = results[i].headline.main;
            headText += results[i].lead_paragraph;

            var html = results[i].web_url;
            console.log(html)
            link.attr("href", html)
            newsDiv.append(img);
            newsDiv.append("<th>" +"Heading: " + headText + "</th>" + "<br>");
            newsDiv.append("<th>" +"Link: " + link + "</th>" + "<br>");
           $("#display").append(newsDiv);
        
        }

        });
      });


  $("#clr").on("click", function() {
       $("#display").empty();
        $("#rContainer").hide();
  });

</script>

</body>
</html>












 
 