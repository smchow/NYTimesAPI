<!DOCTYPE html>
<html lang="en">

<?php include "index.php";?>

<head>
	<meta charset="utf-8">
	<title></title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> 
   <title>New York Times Search</title>

 <!--  <link rel="stylesheet" href="../assets/css/font-awesome.min.css"> -->
  <link rel="stylesheet" type="text/css" href="assets/css/style.css">
</head>

<body>



	
	
  <script src="https://use.fontawesome.com/7b6dd2ca46.js"></script>
<div class="container">
    <div class="jumbotron">
<!-- here is the link given to me by glyphSearch for the newspaper icon. I don't know how to make it work -->
<i class="fa fa-newspaper-o"></i> 
    New York Times Search</div>

     
<div class="container" >
   <div class="row">
      <div class="panel panel-default">
        <div class="panel-heading" id="searchpar">
          <h3>Search Parameters</h3>
        </div>
        <div class="panel-body">
        <form>
        <div class="form-group">
          <label for="exampleInputEmail1">Search Term</label>
          <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Keyword">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">Number of Records to Retrieve:</label>
          <input type="text" class="form-control" id="numRecords" placeholder="10">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">Start Year(Optional):</label>
          <input type="number" class="form-control" id="startDate" placeholder="YYYYMMDD">
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">End Year(Optional):</label>
          <input type="number" class="form-control" id="endDate" placeholder="YYYYMMDD">
        </div>
        </form>
        <button type="submit" class="btn btn-default" id="frmSubmit">
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
        Search
        </button>
        <button type="submit" class="btn btn-default" id="clr">
        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        Clear Results</button>

      
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container" id="rContainer">
   <div class="row">
      <div class="panel panel-default">
        <div class="panel-heading" id="searchpar">
          <h3>Search Results</h3>
        </div>
        <div class="panel-body" id="display">


        </div>
      </div>
    </div>
  </div>

  
  <!-- Displaying the results -->

  <div ></div>
  <div> 
  <div class="container">
   <div class="row">
        
   </div>
   </div>
  <!-- <dl class="dl-horizontal">
    <dt>First Name</dt>
    <dd>Foo</dd>
    <dt>Last Name</dt>
    <dd>Bar</dd>
    <dt>Job</dt>
    <dd><img src="http://www.nytimes.com/images/2016/12/13/arts/13GLOBES-REAX-MOONLIGHT1/13GLOBES-REAX-MOONLIGHT1-thumbWide.jpg"></dd>
  </dl> -->

 <script src="https://code.jquery.com/jquery.js"></script>
 <script type="text/javascript">
  $("#rContainer").hide();

	$("#frmSubmit").on("click", function() {

		var url = "https://api.nytimes.com/svc/search/v2/articlesearch.json";
		var base_url = "http://www.nytimes.com/";
    var q = ($("#exampleInputEmail1").val()).trim();
    var begin_date = ($("#startDate").val()).trim();
    var end_date = ($("#endDate").val()).trim();

		url += '?api-key=05dd5e0a5d1841718337d9de569ceb6c&q='+q;
    if(begin_date != ""){
      url += '&begin_date='+ begin_date;
    }
    if(end_date != ""){
      url += '&begin_date='+ end_date;
    }
    console.log(url);

    /*'?' + $.param({
  		'api-key': "05dd5e0a5d1841718337d9de569ceb6c",
  		'q':  "golden globe",
		  'begin_date': "20120101",
		  'end_date': "20161231",
		  'hl': "true",
		  'facet_field': "source",
		  'facet_filter': "true"
			});*/
      console.log(url);

			$.ajax({
  					url: url,
  					method: 'GET'

				})										
		 .done(function(database) {
			// response.addHeader("Access-Control-Allow-Origin", "http://www.nytimes.com");
        	console.log(database);
        $("#rContainer").show();
        	var results = database.response.docs;
        	console.log(results.length);

        	for (var i = 0; i < results.length; i++) {
            var newsDiv = $("<div class='item'>");

            var img = $("<img>");
            
            if (results[i].multimedia[0].url != "" ){
              var docImage = base_url + results[i].multimedia[0].url;
              img.attr("src" , docImage);
              console.log(results[i].multimedia[0].url);
           }
            

            
            var text = results[i].headline.main;
            //text += results[i].lead_paragraph;
            //text += results[i].web_url;
           	
           	newsDiv.prepend(text);
            newsDiv.prepend(img);

           $("#display").prepend(newsDiv);
     		
     		}
     	});
      });

  $("#clr").on("click", function() {
       $("#display").empty();
        $("#rContainer").hide();
  });

</script>

</body>
</html>